# vscode-claude-workflow - 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
**vscode-claude-workflow**

### 1.2 目的
Claude CodeとVSCodeを統合し、日本語GUIを通じて複数のAIエージェントがステップバイステップで協働する開発支援システムを提供する。

### 1.3 ターゲットユーザー
- **プライマリ**: プログラミング初心者〜中級者の日本語話者
- **セカンダリ**: 高度なカスタマイズを求める上級開発者

### 1.4 配布方法
- GitHubでのオープンソース公開
- VSCode Marketplaceでの配布（将来的に）

---

## 2. 機能要件

### 2.1 コアエージェント（Phase 1 - MVP）

#### 2.1.1 オーケストレーターエージェント
**責務**: 全エージェントの統括・ワークフロー管理

**機能**:
- タスクの解析と適切なエージェントへの振り分け
- エージェント間の実行順序制御（PM → エンジニア → レビュアー）
- 各エージェントの出力を次のエージェントへ引き継ぎ
- エラーハンドリングと再実行制御
- 進捗状況の可視化

**入力**: ユーザーからのタスク指示（日本語）
**出力**: 各エージェントの実行結果の統合レポート

#### 2.1.2 PMエージェント
**責務**: プロジェクト管理・要件整理

**機能**:
- ユーザー要求の構造化・明確化
- 実装計画の立案（タスク分解、優先順位付け）
- 技術的制約の特定
- 成果物の定義

**入力**: オーケストレーターからのタスク、既存コードベース情報
**出力**: 構造化された実装計画（JSON/Markdown形式）

#### 2.1.3 エンジニアエージェント
**責務**: コード実装

**機能**:
- PMの計画に基づいたコード生成
- 既存コードとの整合性保持
- コーディング規約の遵守
- 依存関係の管理

**入力**: PMエージェントの計画、既存コードベース
**出力**: 生成されたコード、変更ファイルリスト

#### 2.1.4 レビュアーエージェント
**責務**: セキュリティ・品質チェック

**機能**:
- セキュリティ脆弱性チェック（OWASP Top 10等）
- コード品質評価（可読性、保守性、パフォーマンス）
- ベストプラクティス遵守確認
- 改善提案の生成

**入力**: エンジニアエージェントが生成したコード
**出力**: レビューレポート、改善提案リスト

---

### 2.2 実行フロー

```
ユーザー入力（日本語タスク）
    ↓
オーケストレーター（タスク解析）
    ↓
PMエージェント（計画立案）
    ↓ [計画確認・承認]
    ↓
エンジニアエージェント（コード生成）
    ↓ [コード確認]
    ↓
レビュアーエージェント（品質・セキュリティチェック）
    ↓
最終成果物の提示
```

**対話ポイント**:
- PMの計画後: ユーザーに計画を提示し、承認を得る
- コード生成後: 生成されたコードを確認してもらう
- レビュー後: 改善提案を確認し、修正するか判断

---

### 2.3 UI/UX要件

#### 2.3.1 日本語GUI形式
**採用**: VSCode拡張機能のカスタムUI

**UIコンポーネント**:
1. **サイドバーパネル**
   - エージェント一覧と状態表示
   - 実行履歴
   - クイックアクション

2. **メインビュー**
   - タスク入力フォーム
   - エージェント実行結果の表示
   - 対話形式のチャットインターフェース

3. **ステータスバー**
   - 現在実行中のエージェント表示
   - 進捗インジケーター

#### 2.3.2 ユーザー操作方法

**1. プリセットタスク選択**
例:
- 「新機能を追加」
- 「バグを修正」
- 「コードをリファクタリング」
- 「セキュリティ診断」

**2. 自由なプロンプト入力**
- テキストエリアで日本語でタスクを記述
- マークダウン対応

**3. ファイル/コード選択連携**
- VSCodeで選択中のファイル/コードを自動的にコンテキストとして渡す
- 右クリックメニュー「Claude Workflowで処理」

**4. 対話形式**
- エージェントからの質問に回答
- 各ステップで承認/修正指示

---

### 2.4 技術要件

> **重要な変更**: Claude API（従量課金）方式から **Claude Code CLI統合方式** に設計変更しました。
> これにより、**Claude Pro / 5MAX / 10MAXプラン** のユーザーが追加コストなしで利用可能になります。

#### 2.4.1 使用技術スタック
- **VSCode拡張**: TypeScript
- **エージェント実装**: Claude Code CLI + .claude/agents/*.md
- **Claude実行環境**: Claude Code CLI（Pro / 5MAX / 10MAXプラン）
- **パッケージマネージャー**: npm/pnpm

#### 2.4.2 Claude Code統合
- **Claude Code CLIをchild_processで実行**
- 各エージェント（PM、エンジニア、レビュアー、オーケストレーター）を `.claude/agents/*.md` ファイルで定義
- エージェント間通信はTask toolを使用してオーケストレーターが制御
- Claude CodeのRead, Write, Edit, Bash等のツールを各エージェントで利用可能

#### 2.4.3 前提条件
- **Claude Code CLIがインストール済み**であること
- **Claude Pro / 5MAX / 10MAXプランに加入**していること
- APIキーは不要（Claude Codeの認証を使用）

---

## 3. 非機能要件

### 3.1 パフォーマンス
- エージェント起動時間: 3秒以内
- タスク全体の実行時間: 小規模タスクで1分以内（API応答時間を除く）

### 3.2 ユーザビリティ
- 日本語メッセージの自然さ
- 初回セットアップは10分以内に完了
- プリセットタスクは2クリック以内で実行開始

### 3.3 拡張性
- 新しいエージェントを追加可能な設計
- カスタムプリセットタスクの追加が容易
- 設定ファイルによるカスタマイズ対応

### 3.4 セキュリティ
- Claude Code CLIの認証を使用（APIキー管理不要）
- ローカル実行を基本とし、外部への不要なデータ送信なし
- エージェント定義ファイル（.claude/agents/*.md）をバージョン管理で共有可能

---

## 4. 実装フェーズ

### Phase 1: MVP（最小機能実装）
**目標**: 基本的な4エージェント連携を実現

**成果物**:
- オーケストレーター、PM、エンジニア、レビュアーの4エージェント
- 基本的なVSCode UI（サイドバー + コマンドパレット）
- 順次実行フロー
- シンプルな日本語プロンプト入力

**期間目標**: MVP完成

---

### Phase 2: 機能拡張
**追加機能**:
- テスターエージェント（テストコード生成・実行）
- プリセットタスク機能
- ファイル/コード選択連携
- 実行履歴の保存・再利用

---

### Phase 3: 高度な機能
**追加機能**:
- ドキュメント生成エージェント
- リファクタリングエージェント
- カスタムエージェント作成機能
- 並列実行モード（実験的）

---

## 5. ドキュメント要件

### 5.1 必須ドキュメント

#### 5.1.1 claude.md
Claude Code向けのプロジェクト説明ファイル

**内容**:
- プロジェクト概要
- アーキテクチャ説明
- 各エージェントの役割と実装詳細
- 開発時の注意事項

#### 5.1.2 skill.md
カスタムSkill定義（必要に応じて）

**想定Skill例**:
- `/workflow-start [タスク]` - ワークフロー開始
- `/workflow-status` - 実行状況確認
- `/agent-debug [エージェント名]` - エージェントデバッグ

#### 5.1.3 README.md（日本語 + 英語）
GitHub公開用

**内容**:
- プロジェクト説明
- インストール方法
- 使い方（スクリーンショット付き）
- 設定方法
- コントリビューションガイド
- ライセンス

#### 5.1.4 ARCHITECTURE.md
技術者向けアーキテクチャドキュメント

**内容**:
- システムアーキテクチャ図
- データフロー
- エージェント間通信プロトコル
- 拡張方法

---

## 6. 成功指標

### 6.1 技術的成功指標
- [ ] 4つのコアエージェントが正常に連携動作
- [ ] 簡単なタスク（例: CRUD機能追加）が自動で完了
- [ ] レビュアーが主要な脆弱性を検出可能

### 6.2 ユーザー体験指標
- [ ] 初心者が15分以内に最初のタスクを実行できる
- [ ] 日本語UIが自然で理解しやすい
- [ ] エラー発生時に適切な日本語メッセージで復旧方法を提示

### 6.3 公開後の指標（将来的）
- GitHub Stars: 100+
- 実際のユーザーフィードバック収集
- コントリビューター獲得

---

## 7. リスクと対策

### 7.1 技術的リスク
**リスク**: Claude Code CLIのバージョン依存
**対策**: バージョンチェック機能を実装、互換性レイヤーの導入

**リスク**: エージェント間の無限ループ
**対策**: 最大実行回数制限、タイムアウト設定

**リスク**: Claude Code CLIが未インストール
**対策**: インストールチェックと分かりやすいインストールガイドの提供

### 7.2 ユーザビリティリスク
**リスク**: 初心者には複雑すぎる
**対策**: プリセットタスクとウィザード形式のガイド

### 7.3 プロジェクトリスク
**リスク**: スコープクリープ
**対策**: Phase 1のMVPに集中、機能追加は段階的に

---

## 8. 次のステップ

1. プロジェクト構成の設計
2. 各エージェントの詳細設計（claude.md作成）
3. VSCode拡張の基本構造実装
4. オーケストレーターエージェントのプロトタイプ
5. MVP実装開始

---

**作成日**: 2026-01-03
**最終更新**: 2026-01-03
**バージョン**: 2.0（Claude Code統合版）
